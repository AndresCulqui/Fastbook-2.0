


<polymer-element name="sell-element" >
    <template>
        <style>
        :host {
 
        }
        
   paper-input-decorator /deep/ .label-text {
    /* inline label,  floating label, error message and error icon color when the input is unfocused */
    color: blue;
}

paper-input-decorator /deep/ .error{
  color:red;
}
paper-input-decorator /deep/ ::-webkit-input-placeholder {
    /* platform specific rules for placeholder text */
    color: black;
}

 
        section{
          
      margin: 20px;
      border:2px white solid;
      border-radius: 7px;
      background: rgba(95,31,7, 0.2);

      //background-color: beige;
        }
        h2{
      margin-left: 10%;
      color:whitesmoke;
      font-size: 250%;
      font-family: Oswald;
      text-shadow:grey 0.1em 0.1em 0.2em;
      //text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
      }
      #main {
 
      border-radius: 7px;
      padding: 20px;
      }
      .pi{
   
      width: 30%;
      margin: 0px;
      padding: 0px;
    
      }
      #cate, #provi{
        float: left;
      }
      #cat{
        width: 100%;
      }
      .paper-input{
        width: 40%;
      }
      #left, #right {
             
          background-image: url('../images/form.png');
          background-size: 100% 100%;
          border: 5px solid;
          border-radius: 10px;
      
   
      }
      #tit{
       font-size:300%;
       
      }

      #left {
          width: 40%;
         
          margin-right: 2%;
          padding-left: 4%;
          padding-right: 4%;
          float: left;
      }
      #right {
          
          margin-left: 50%;
         padding-left: 4%;
          padding-right: 4%;
   
      }
      #butt{
        margin-left: 40%;
        margin-top: 2%;
      }
      core-input{
        color:black;
      }

       @media (max-width: 600px) {

          #main { margin: 0px;padding:0px}
          h1 { margin-bottom: -10px; font-size: 20px;}

          #left, #right {
         
              width: 88%;
           background-image: none;
              height: auto;
          }
          #mobile{
            background-image: url('../images/form.png');
          }

          #left {
              float: none;
              margin-right: 40%;
              border-bottom: 0px;
              border-bottom-left-radius: 0px;
              border-bottom-right-radius: 0px; 
          }
          #right{
            border-top: 0px;
              margin-top: 0%;
              margin-left: 0px;
               border-top-left-radius: 0px;
              border-top-right-radius: 0px; 
          }
          paper-input-decorator {
              width: 100%;
              padding: 0px 0px 0px 0px;
              margin-bottom: 0px;
          }
          #tit{
            font-size: 150%;
          }
        }

        </style>
        <section id="main" >
          <div id="tit">Put a book for sale </div>
          <div id="mobile">
          <div  id="left">
            
            

            
            

         
            
             <paper-input-decorator label="Title" floatingLabel error="Title is required!">
              <input is="core-input" id="titulo" on-blur="{{valid}}" required/>
             </paper-input-decorator>
             
              <paper-input-decorator label="Author" floatingLabel error="Author is required!">
              <input is="core-input" id="autor" on-blur="{{valid}}" required/>
             </paper-input-decorator> 


              
             <paper-input-decorator label="ISBN" floatingLabel error="ISBN is required!" id="decoisbn" >
               <input is="core-input" id="isbn" on-blur="{{validateIsbn}}" required/>
             </paper-input-decorator>
              
          
             <!-- <paper-button id="butt" on-tap="{{validateIsbn}}">Comprobar ISBN</paper-button>-->

             <div id="divisbn" hidden>
               
               <core-input id="tisbn" disabled></core-input>
               <core-input id="ttitulo" disabled></core-input>
               <core-input id="tautor" disabled></core-input><br>
                <img id="timg"></img>
               
             </div>
              
           

            
          </div>
          <div id="right">
            
            
              <paper-input-decorator label="Publisher" floatingLabel error="Publisher is required!">
              <input is="core-input" id="editorial"on-blur="{{valid}}"/>
             </paper-input-decorator>
              
            <paper-input-decorator label="Price" floatingLabel error="Price is required!" id="decoprecio">
              <input is="core-input" id="precio"  on-blur="{{valid}}" required/>
             </paper-input-decorator>
              
            
            
            
            
            <paper-input-decorator label="Category" floatingLabel error="Category is required!" id="cate" class="pi">
              <select id="cat"  on-blur="{{valid}}">
               
                   
                  <option value="0"> Select Category</option>          
                <option >primaria </option>
                <option> secundaria</option>
                <option > bachillerato</option>
                <option> universidad</option>
                <option> formacion profesional</option>
                <option > oposiciones</option>
                <option  >lectura</option>
                                     
             
                
             
               </select> 
                 </paper-input-decorator>   
            
      
            <paper-input-decorator label="Province" floatingLabel error="province is required!"id="provi" class="pi" >
            <select id="pro" on-blur="{{valid}}">
                 <option value="0"> Select Province</option>      
              <option> A Coruña</option>
              <option> Alicante</option>
                <option>Albacete</option>
                <option>Almería</option>
                <option>Araba</option>
                <option >Asturias</option>
                <option>Ávila</option>
                <option >Badajoz</option>
                <option >Balears</option>
                <option>Barcelona</option>
                <option >Bizkaia</option>
                <option >Burgos</option>
                <option >Cáceres</option>
                <option >Cádiz</option>
                <option >Cantabria</option>
                <option >Castelló</option>
                <option >Ceuta</option>
                <option >Ciudad Real</option>
                <option >Córdoba</option>
                <option>Cuenca</option>
                <option >Girona</option>
                <option>Granada</option>
                <option >Guadalajara</option>
                <option >Guipuzkoa</option>
                <option >Huelva</option>
                <option>Huesca</option>
                <option >Jaén</option>
                <option>La Rioja</option>
                <option >Las Palmas</option>
                <option >León</option>
                <option >Lleida</option>
                <option >Lugo</option>
                <option>Madrid</option>
                <option >Málaga</option>
                <option >Melilla</option>
                <option>Murcia</option>
                <option >Navarra</option>
                <option >Ourense</option>
                <option >Palencia</option>
                <option >Pontevedra</option>
                <option >S.C. Tenerife</option>
                <option >Salamanca</option>
                <option>Segovia</option>
                <option >Sevilla</option>
                <option >Soria</option>
                <option >Tarragona</option>
                <option>Teruel</option>
                <option >Toledo</option>
                <option >Valencia</option>
                <option >Valladolid</option>
                <option >Zamora</option>
                <option >Zaragoza</option> 
            </select>
            </paper-input-decorator>
          
            <paper-input-decorator label="Status" floatingLabel error="Status is required!" id="esta" class="pi">
            <select id="est" on-blur="{{valid}}"> 
                 <option value="0"> Select Status</option>    
                <option >Muy malo</option>
                <option>Malo</option>
                <option>Normal</option>
                <option>Bueno</option>
                <option >Muy bueno</option>
            </select>
            </paper-input-decorator><br>
            
       
            <paper-input-decorator label="Description (max 515 )" floatingLabel error="description is required!" id="desc">
              <textarea id="descripcion"rows="4" cols="50"  maxlength="517"required on-blur="{{valid}}"></textarea>
            </paper-input-decorator>  
         <!--   <span class="titulo">Añade algunas imágenes, ¡se venderá más rápido!</span><br><br>
                            
                <label for="img1">imagen #1</label>
                <input type="file" name="img1" id="img1" tabindex="12"/><br>
      
                <label for="img2">imagen #2</label>
                <input type="file" name="img2" id="img2" tabindex="13"/>-->
                                 
  
            
          <div id="foo">
            <paper-button id="butt" on-tap="{{validates}}">Continue y publish</paper-button>
          </div>
        
              
        </div>

          </div>
        </section>     
      


     
    </template>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        Polymer({

          
               ready:function(){
                    
                  this.socket = io();
                 
                
                  var that=this;
                  
                    $.get('/profile',function(data){
                       var t=that.$.tit;
                      if(data.user){
                         that.$.butt.active="true";

                      $(t).text("Put a book for sale");

                    }else{
                       
                        $(t).text(" You must login to upload a book ");
                         that.$.butt.disabled="true";
                      }
                    });
                   
                  
                },
           
                validateIsbn:function(){
                  
                  
                  
                   var isbn=this.$.isbn;
                   var that=this;
                
                   
                   if(isbn.validity.valid){
                     if(validator.isISBN(isbn.value)){
                        this.$.divisbn.hidden=!this.$.divisbn.hidden;
                      this.$.decoisbn.isInvalid=false;
         
                      this.$.tisbn.value="El ISBN "+isbn.value+" es correcto ";
                      this.$.ttitulo.value=" ";
                       this.$.tautor.value="";
                       this.$.timg.src="";
                     

              
                      var book="https://www.googleapis.com/books/v1/volumes?q=isbn:"+isbn.value;
                     
                      $.getJSON(book,function(result){
                       
                       var titulo=result.items[0].volumeInfo.title;
                       var autor=result.items[0].volumeInfo.authors;
                      var isbn=result.items[0].volumeInfo.industryIdentifiers[0].identifier;  
                      that.imagen=result.items[0].volumeInfo.imageLinks.thumbnail;

                       // Set the table td text
                       that.$.tisbn.value="El ISBN   "+isbn+"  corresponde a:";
                       that.$.ttitulo.value="Titulo:   "+titulo;
                      
                       that.$.timg.src=that.imagen;
                     
                     });
                     }else{
                       this.$.decoisbn.isInvalid=true;
                       this.$.decoisbn.error="ISBN Invalid!";
                       this.$.divisbn.hidden=true;
                 
                     }
                  
                     
                    }else{
                      this.$.decoisbn.isInvalid=true;
                      this.$.decoisbn.error="ISBN is required!";
                      this.$.divisbn.hidden=true;
                    }
                },
                
                validates: function(){
                  
                  if(this.valid()){
                 
                  var genre=this.$.cat.value;
                  var province=this.$.pro.value;
                   var isbn=this.$.isbn.value;
                  var author=this.$.autor.value;
                  var publisher=this.$.editorial.value;
                  var status=this.$.est.value;
                  var price=this.$.precio.value;
                  var title=this.$.titulo.value;
                  var description=this.$.descripcion.value;
                  var that=this;
                  var imagen=this.$.timg.src;
                
                var that=this;

                 var token=window.localStorage.getItem('token');

                  var newbook={
                     genre : genre,
                    province : province,
                     isbn : isbn,
                    author : author,
                    publisher : publisher,
                    status : status,
                    price : price,
                    title : title,
                    description : description,
                    imagen:imagen,
                    value:0,
                    id_user:token
                    };
               
                  //------------apiss/////

                 
                 $.post("/book",newbook,
                    function(data,status){
                      if (status){
                      alert("Book Save¡¡¡¡¡" + status);
                       that.socket.emit('chat message', newbook);
                     
                      location.reload();
                    }else{
                      alert("error¡¡¡¡");
                    }
                     
                    });
                    
            
              }else{
                this.valid();
              }
                  
                },
                
                valid:function(){
                
                var inn=this.$.main.querySelectorAll('input');
                var flag=true;
                 
                for(var j=0;j<5;j++){             
               
                  if(inn[j].validity.valid==false){
                    flag=false;
                    
                    }
                }
                 
                var $d=this.$.main.querySelectorAll('paper-input-decorator');
           
                   for(var i=0;i<4;i++){
                      $d[i].isInvalid = !$d[i].querySelector('input').validity.valid;
                    
                    
                   }
                   var code=this.$.isbn.value;
                   
                   console.log(code);
                   if(this.$.isbn.validity.valid){
                                        if(validator.isISBN(code)){
                     console.log("isbn correcto");
                     this.$.decoisbn.isInvalid=false;
                   }else{
                     flag=false;
                     this.$.decoisbn.isInvalid=true;
                     this.$.decoisbn.error="ISBN Invalid!";
                     this.$.divisbn.hidden=true;
                   }
    
                   }else{
                     flag=false;
                     this.$.decoisbn.isInvalid=true;
                     this.$.decoisbn.error="ISBN required!";
                     this.$.divisbn.hidden=true;
                   }
                   

                
    
                      
                      
         
    
                   if(this.$.cat.value ==0){
                        this.$.cate.isInvalid=true;
                        flag=false;
                        
                      }else{
                        this.$.cate.isInvalid=false;
                       
                      }
                  if(this.$.pro.value ==0){
                        this.$.provi.isInvalid=true;
                        flag=false;
                      }else{
                        this.$.provi.isInvalid=false;
                       
                      
                    }
                  if(this.$.est.value ==0){
                        this.$.esta.isInvalid=true;
                        flag=false;
                      }else{
                        this.$.esta.isInvalid=false;
                     
                      }
                  if(this.$.descripcion.value ==""){
                    this.$.desc.isInvalid=true;
                    flag=false;
                  }else{
                    this.$.desc.isInvalid=false;
                    
                  }
                  var precio=this.$.precio;
                  
                  if(validator.isNumeric(precio.value)){
                  console.log("el precio es numerico      soy value precio");
                    this.$.decoprecio.isInvalid=false;
                }else{
                  console.log("el precio no es numerico");
                 this.$.decoprecio.isInvalid=true;
                     this.$.decoprecio.error="price Invalid!";
                     flag=false;
                }
                    return flag;
                   
                },
                focus:function(){
                     //this.socket.emit('chat message', "libro nuevo añadido"); 
                }
            
        });
    </script>
</polymer-element>
