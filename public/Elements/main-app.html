<link rel="import" href="../lib/flatiron-director/flatiron-director.html">
<polymer-element name="main-app">
	<template>
    <flatiron-director route="{{route}}" autoHash></flatiron-director>
		<style>
		core-drawer-panel{
	
			}
		
			my-head /deep/ #title{
				font-size: 60px;
			}

			#drawer{
				position: absolute;
				background-color: whitesmoke;
				border-radius: 7px;
				height: 100%;
				z-index: 10;
			}
			#main{
				border:2px solid red;
				
			}
			#container{
					border:2px solid green;
					
			}
			#mn{
				position: fixed;
			}
			core-toolbar {
     		 // float: left;
      			width: 100%;
      			height: 60px;
		        background: rgb(255,123,13); /* Old browsers */
		        background: -moz-linear-gradient(top,  rgba(255,123,13,1) 0%, rgba(255,168,76,1) 60%); /* FF3.6+ */
		        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,123,13,1)), color-stop(60%,rgba(255,168,76,1))); /* Chrome,Safari4+ */
		        background: -webkit-linear-gradient(top,  rgba(255,123,13,1) 0%,rgba(255,168,76,1) 60%); /* Chrome10+,Safari5.1+ */
		        background: -o-linear-gradient(top,  rgba(255,123,13,1) 0%,rgba(255,168,76,1) 60%); /* Opera 11.10+ */
		        background: -ms-linear-gradient(top,  rgba(255,123,13,1) 0%,rgba(255,168,76,1) 60%); /* IE10+ */
		        background: linear-gradient(to bottom,  rgba(255,123,13,1) 0%,rgba(255,168,76,1) 60%); /* W3C */
		        color: #fff;
		      
		     }

		</style>


	<core-drawer-panel id="cdp"responsiveWidth="2000px" >
	
	<div drawer id="drawer" >
	<mobile-menu id="momenu"pages="{{pages}}" user="{{user}}"></mobile-menu>

	</div>
	   

	

<core-header-panel  main  mode="waterfall">
<core-toolbar>
  <my-head id="mh" lang="en" mtitle="FastBook"></my-head>
  	<core-icon-button id="cib"  src="http://tediselmedical.com/wp-content/uploads/2013/11/Spain.png"icon="menu" on-tap=" {{languaje}} " id="languaje" > </core-icon-button>
     
      <core-icon-button  on-tap="{{ tapxploit}}" src="http://lh3.googleusercontent.com/-OrI1DUdm480/T7y_kOxudFI/AAAAAAAAEgE/rp20hOY3H7c/s800/google-plus-share-button-screenshot.png"></core-icon-button>
 </core-toolbar> 
  <my-banner id="mb" lang="en"></my-banner>

	<div id="container">


		<core-animated-pages id="cap" valueattr="hash" selected="{{route}}"
					transitions="slide-from-right">
			
			<section  hash="home">
					<core-animation id="ca"></core-animation>

			</section >
			<section  hash="search">
					<core-search></core-search>
			</section >

			<section  hash="buy">
					
					<mi-biblioteca></mi-biblioteca>
			</section>
			<section  hash="sell">
					
					<sell-element></sell-element>
			</section>
			<section  hash="account">
        <core-perfil></core-perfil>
				<!--	<fast-account id="fa"></fast-account>-->
          				
			</section>
			<section id="detailbook" hash="">	
        <book-detail id="bdetail" book="{{book}}"></book-detail>
			</section>

		</core-animated-pages>

	</div>

  </core-header-panel>

</core-drawer-panel>
</template>
	<script>
	    


//--------------------------escuchando eventos------------------------

	Polymer({
		ready:function() {

			this.pages=this.$.mh.pages;
			this.$.mh.lang="en";
			this.$.mb.lang="en";
	
      this.$.detailbook.hash=this.route;
      
      
      
//-------------------escuchando evento closedialog de bookdetail-----------------------
			this.$.bdetail.addEventListener('closedialog', function(e) {
          that.route="home";
		  	});

//-------------------escuchando evento bookdetail en slider-----------------------
			this.$.ca.addEventListener('bookdetail', function(e) {
        that.book=e.detail;
        that.$.detailbook.hash="bookdetail"+that.book._id;
           that.route="bookdetail"+that.book._id;
        
          
		  	});
			//-------------------escuchando evento boton menu left-----------------------
			this.$.mh.addEventListener('actionMenu', function() {
		    	that.$.cdp.togglePanel();
		  	});
		  	//-------------------escuchando evento menu principal-----------------------
			this.$.mh.addEventListener('mainMenu', function(e) {
		    	
		    	that.route=e.detail;

		    	
		  	});
		  	//-------------------escuchando evento menu left-----------------------
			this.$.momenu.addEventListener('leftMenu', function(e) {
		    	
		    	that.route=e.detail;
		    	that.$.cdp.closeDrawer();
		    	
		  	});
		  	//-------------------escuchando evento slected-book-----------------------
			this.$.ca.addEventListener('selectedBook', function(e) {
		    	
		    	console.log(e.detail.alt+"           soy evento ");
		    	
		    	
		  	});	
      //--------------------------escuchando evento load profile-----------------------
      /*this.$.fa.addEventListener('profile-load',function(e){
        console.log(e.detail.name+"  soy profile en main");
        that.user=e.detail;
      });*/
    
    //----------------------------google sing escuchandoooo
        var that=this;
         this.$.fa.addEventListener('google-signin-success', function(a,b,c) {
		    	var token=a.detail.result.access_token;
          console.log(token);
          
          $.post('/googleUser',{token:token}, function(data,status){     
              if (status){
                     console.log(data);
                 that.user={id:data.id,name:data.name, email:data.email, photo:data.image};
                      
               }else{
                    alert("error¡¡¡¡------------------------->");
                 }
                     
            });
               
               
        //-----------------------------revokar token----------------------       
             var revokeUrl = 'https://accounts.google.com/o/oauth2/revoke?token='+token;
                        

            
                  that.$.fa.addEventListener('google-signed-out',function(e){
                      console.log(e.returnValue+"soy return valueeee si esta desconectado");
                      if(e.returnValue){

                        $.ajax({
                               type: 'GET',
                               url: revokeUrl,
                               async: false,
                               contentType: "application/json",
                               dataType: 'jsonp',
                               success: function() {
                                 location.reload();  
                               },
                               error: function(e) {

                               }
                             }); 

                        console.log("soy true");
                      }else{
                        console.log("soy false");
                      }

                       });
               
               
         });
         
      //------------------------------------escuchando facebook--------------------------ç
          
          this.$.fa.addEventListener('facebook-signin-success', function(a) {
		    	
          console.log(a.detail);
      
           });
          
          
          
          
          
          
          
      
		},
     tapxploit:function(){
      
      window.open("/xploit.html","width=200, height=100","toolbar=no").scrollTo(0, 1);

          
   
      
    },
		languaje: function  (a,b,c) {

			if(this.$.mh.lang=="en"){
				this.$.mh.lang="es";
				this.$.mb.lang="es";
				this.$.mh.ready();
				this.$.momenu.pages=this.$.mh.pages;
				this.$.cib.src="http://tediselmedical.com/wp-content/uploads/2013/11/United_Kingdom.png";
			}else if(this.$.mh.lang=="es"){
				this.$.mb.lang="en";
				this.$.mh.lang="en";
				this.$.mh.ready();
				this.$.momenu.pages=this.$.mh.pages;
				this.$.cib.src="http://tediselmedical.com/wp-content/uploads/2013/11/Spain.png";
			}
		
			this.$.mb.languaje(this.$.mh.lang);
		}



	});
	</script>
</polymer-element>