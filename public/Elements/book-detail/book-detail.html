<polymer-element name="book-detail" attributes="book miroute">
  <template>
<!--    <flatiron-director route="{{route}}" autoHash></flatiron-director>-->
    <style>
      :host {
          position: absolute;
          width: 100%;
          height: 100%;
          box-sizing: border-box;
      }
      #dialog {
        margin: 20px;
      }
      #book {
        background: white;
        border-radius: 6px;
        margin: 20px auto;
        padding: 20px;
        width: 800px;
      }
      #title {
        margin: 0px;
        font-size: 2em;
      }
      em {
        color: cadetblue;
      }
      .fields {
        width: 100%;
        background: #F1F1F1;
        padding: 5px;
        margin-top: 10px;
        border-radius: 6px;
      }
      #description {
        margin-top: 10px; 
        height: 200px;
        overflow: auto;
        text-align: justify;
      }
      .buttons {
        margin: 10px;
        background: #F1F1F1;
        color: cadetblue;
      }
      #photo {
        margin-bottom: 10px;
        text-align: center;
        width: 30%;
        float: left;
      }
      #data {
        margin-left: 1%;
        float: right;
        width: 69%;
      }
      #buttons {
        text-align: center;
      }
      #star {
        float: right;
      }
      @media (max-width: 850px) {
        #title {
          font-size: 1.5em;
        }
        #book {
          width: 90%;
        }
        #photo {
          width: 100%;
          float: none;
        }
        #data {
          margin-left: 0;
          width: 100%;
          float: none;
        }
        #star {
          position: relative;
          float: none;
        }
      }
      
    </style>
    <paper-action-dialog heading="Title" role="dialog" layout="" vertical="" aria-label="Title" tabindex="-1" style="position: fixed; outline: none; z-index: 12; top: 226px; left: 0px;">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>

      <paper-button dismissive="" role="button" tabindex="0">More Info...</paper-button>
      <paper-button affirmative="" role="button" tabindex="0">Decline</paper-button>
      <paper-button affirmative="" autofocus="" role="button" tabindex="0">Accept</paper-button>
    </paper-action-dialog>
    
      <section id="dialog">
        <div id="book">
            <div id="title">{{book.title}}</div>
            <paper-button id="bookUpdate" class="buttons" on-tap="{{bookUpdate}}">Modify</paper-button>
            <div id="star"><star-rate id="rate" value="{{book.value}}" on-tap="{{starrate}}"></star-rate></div>
            <div>
                <div id="photo">
                  <div id="buttons" layout horizontal>
                    <paper-button class="buttons" on-tap="{{buy}}">Buy</paper-button>
                    <paper-button class="buttons" on-tap="{{favorite}}">Favorite</paper-button>
                  </div>
                  <a href="{{book.imagen}}">
                    <img id="imagen" src="{{book.imagen}}" title="{{book.title}}">
                  </a>
                </div>

                <div id="data" layout vertica>
                <p class="fields"><em>Author:</em> {{book.author}}</p>
                <p class="fields"><em>Editorial:</em> {{book.editorial}}</p>
                <p class="fields"><em>ISBN:</em> {{book.isbn}}</p>
                <p class="fields"><em>Category:</em> {{book.category}}</p>
                <p class="fields"><em>Precio:</em> {{book.precio}}</p>
                </div>
             </div>
            <div id="des">
            <p class="fields" id="description"><em>Description:</em> {{book.description}}</p>
            </div>  
          <paper-button class="buttons" dismissive on-click="{{closeDialog}}">Close</paper-button>
          </div>
      </section>
    <core-ajax id="ajax" handleAs="json"></core-ajax>
	</template>
	<script>
		Polymer({
      ready: function() {
        var that=this;
        
          $.get('/profile', function(data,success,error){
                if(data.user){
                    console.log("user en book detail      "+data.user);
                    that.$.bookUpdate.hidden=false;
                }	
                else{
                    console.log(" no hay user en book detail");
                    that.$.bookUpdate.hidden=true;

                }
          })
        
        
        
        if(/bookdetail/.test(this.miroute)) {
          var id = this.miroute.slice(10);
          var ajax = this.$.ajax;
          ajax.url="/book/id/"+id;
          ajax.method="GET";
          ajax.go();
        }
        /****************************** EVENT STAR  ************************************/
        this.$.ajax.addEventListener("core-response", function(e) {
        console.log(e.detail.response.book);
        that.book=e.detail.response.book;
        that.book.value=parseInt(that.book.value*100/10);

        });
      },
      bookUpdate: function() {
        
      },
      closeDialog: function() {
        this.fire("closedialog");
      },
      starrate:function(a,b,c){
     
      var url="/book/"+this.book.isbn;
      console.log(url);
              var bookput={
                 title: this.book.title,
                 author: this.book.author,
                 isbn: this.book.isbn,
                 publisher: this.book.publisher,
                 price: this.book.price,
                 description: this.book.description,
                 genre: this.book.genre,
                 province: this.book.province,
                 status: this.book.status,
                 imagen:this.book.imagen,
                 value:this.book.value+c.value

            };
                   var that=this;
                   var  jbook=JSON.stringify(bookput);
           $.ajax({
                type: "PUT",
                url: url,
                data: jbook,
                contentType: "application/json; charset=utf-8",
                success: function (result) {
                    
                    alert("Book Update¡¡¡");
   
            
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.responseText);
                    
                }
            });

        }
      

		});
	</script>
</polymer-element>